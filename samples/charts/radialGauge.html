<!DOCTYPE html>
<html>
  <head>
    <title>Radial Gauge Chart</title>
    <script src="../../node_modules/chart.js/dist/Chart.bundle.js"></script>
    <script src="../../build/Chart.RadialGauge.js"></script>
    <script src="../utils.js"></script>
    <style>
      canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }
    </style>
  </head>

  <body>
    <div id="canvas-holder" style="width:100%"><canvas id="chart-area"></canvas></div>
    <button id="randomizeData">Randomize Data</button>
    <script>
      var randomScalingFactor = function() {
        return Math.round(Math.random() * 100);
      };

      var canvas = document.getElementById("chart-area");
      var ctx = canvas.getContext("2d");
      var gradientStroke = ctx.createLinearGradient(500, 0, 100, 0);
      gradientStroke.addColorStop(0, "#80b6f4");
      gradientStroke.addColorStop(1, "#f49080");
      var thumbImg = document.createElement("img");
      thumbImg.src =
        "https://d3n8a8pro7vhmx.cloudfront.net/euromove/pages/175/attachments/original/1499183643/Stephen_square_profile.jpg?1499183643";

      thumbImg.onload = function() {
        debugger;
        config.options.centerValue.image = thumbImg;
        //window.myradialGauge.update();
      };

      var config = {
        type: "radialGauge",
        data: {
          datasets: [
            {
              data: [randomScalingFactor()],
              backgroundColor: [gradientStroke],
              borderColor: [gradientStroke]
            }
          ]
        },
        options: {
          responsive: true,
          legend: {
            display: false
          },
          showValue: true,
          title: {
            display: true,
            text: "Chart.js Radial Gauge Chart"
          },
          centerValue: {
            borderWidth: 4
            //            fontFamily: "Verdana",
            // text: "PP",
            // backgroundColor: "rgba(200, 200, 200, 0.3)"
            // draw: function({ ctx, radius }) {
            //   radius = radius - 5;
            //   if (image) {
            //     ctx.beginPath();
            //     ctx.arc(0, 0, radius, 0, Math.PI * 2, true);
            //     ctx.closePath();
            //     ctx.clip();
            //     ctx.drawImage(image, -radius, -radius, 2 * radius, 2 * radius);
            //   }
            // }
          },
          cutoutPercentage: 90,
          domain: [0, 100],
          animation: {
            animateScale: false,
            animateRotate: true
          },
          formatValue(value) {
            return "PP";
          }
        }
      };

      // setInterval(function() {
      //   debugger;
      //   config.data.datasets[0].data = [randomScalingFactor()];
      //   window.myradialGauge.update();
      // }, 3000);

      window.onload = function() {
        var ctx = document.getElementById("chart-area").getContext("2d");
        window.myradialGauge = new Chart(ctx, config);
      };

      document.getElementById("randomizeData").addEventListener("click", function() {
        config.data.datasets.forEach(function(dataset) {
          dataset.data = dataset.data.map(function() {
            return randomScalingFactor();
          });
        });

        window.myradialGauge.update();
      });
    </script>
  </body>
</html>
